<app-navbar></app-navbar>
<main class="container-fluid app-main pl-5 pr-5">
  <div class="row  pl-5 pr-5">
    <button class="btn btn-link text-secondary" routerLink="/home" title="Regresar al Pantalla Principal">
      <span class="fas fa-chevron-left"></span> Pantalla Principal
    </button>
  </div>
  <br>
  <div class="container-fluid pl-5 pr-5">
    <div class="row2">
      <div class="col-lg-19">
        <h4 class="TitleLine">Búsqueda de Coincidencias a Demanda</h4>
      </div>
    </div>
    <div class="tab-content">
      <div>
        <div class="row form-group">
          <div class="col-lg-11 col-sm-12">
            <div class="row">
              <div class="col-xl-2 col-lg-6 d-flex py-1">
                <div class="row col-2 col-sm-4 col-md-6 col-lg-8 col-xl-12">
                  <div class="col-xs-12 col-sm-12">
                    <label class="fontText">Tipo de Búsqueda:</label>
                  </div>
                  <div class="col-xs-12 col-sm-12">
                    <select class="form-control buttonSinBorder colorButton " (change)="searchTypeChange($event)"
                      [(ngModel)]="NBUSCAR_POR">
                      <option value="1">Individual</option>
                      <option value="2">Masiva</option>
                    </select>
                  </div>
                </div>
              </div>
              <div [hidden]="hideIndividual" class="col-xl-2 col-lg-6 d-flex py-1">
                <div class="row col-2 col-sm-4 col-md-6 col-lg-8 col-xl-12">
                  <div class="col-xs-12 col-sm-12">
                    <label class="fontText">Tipo de Documento:</label>
                  </div>
                  <div class="col-xs-12 col-sm-12">
                    <select id="tipoDoc" class="form-control buttonSinBorder colorButton" [(ngModel)]="NOMBRE_RAZON">
                      <option value="0" title="Seleccione">Seleccione</option>
                      <option value="2" title="DNI">DNI</option>
                      <option value="1" title="RUC">RUC</option>
                      <option value="3" title="CE">CE</option>
                      <option value="4" title="PASS">PASS</option>
                    </select>
                  </div>
                </div>
              </div>
              <div [hidden]="hideIndividual" class="col-xl-3 col-lg-6 d-flex py-1">
                <div class="row col-2 col-sm-4 col-md-6 col-lg-8 col-xl-12">
                  <div class="col-xs-12 col-sm-12">
                    <label class="fontText">Número de Documento:</label>
                  </div>
                  <div class="col-xs-12 col-sm-12">
                    <input id="doc" type="text" class="form-control buttonSinBorder colorButton"
                      maxlength="{{validationCantidadCaracteres()}}" size="20" (keypress)="validaNumericos($event)"
                      [(ngModel)]="numeroDoc" placeholder="Número de Documento">
                  </div>
                </div>
              </div>
              <div [hidden]="hideIndividual" class="col-xl-4 col-lg-6 d-flex py-1">
                <div class="row col-2 col-sm-4 col-md-6 col-lg-8 col-xl-12">
                  <div class="col-xs-12 col-sm-12">
                    <label class="fontText">Nombre Completo:</label>
                  </div>
                  <div class="col-xs-12 col-sm-12" style="display:flex;">
                    <input type="text" class="form-control buttonSinBorder colorButton" maxlength="100" size="30"
                      [(ngModel)]="nombreCompleto" (keypress)="soloLetras($event)"
                      pattern="[a-zA-Z\u00f1\u00d1]+ [a-zA-Z\u00f1\u00d1]+ [a-zA-Z\u00f1\u00d1]+"
                      placeholder="Nombre Completo">
                    <div type="button" data-toggle="tooltip" data-placement="top"
                      title="[Apellido1] [Apellido2] [Nombre]">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                        class="bi bi-info" viewBox="0 0 16 16" style="border: 1px solid #A6A6A6; border-radius: 50px">
                        <path
                          d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z" />
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
              <div [hidden]="hideIndividual" *ngIf="mostrarBotonBuscarIndividual()"
                class="col-lg-1  py-1 positionbutton" style="align-self: flex-end;padding-left: 0;">
                <button _ngcontent-qgx-c1="" id="enter" class="btn btn-warning text-white px-4 btnBuscarStyle"
                  (click)="validarNulos()">
                  Buscar
                </button>
              </div>
              <div [hidden]="hideMasiva" class="col-xl-4 col-lg-6 d-flex py-1 col-lg-1 ">
                <div class="row col-2 col-sm-4 col-md-6 col-lg-8 col-xl-12 " style="align-items: self-end; padding: 0;">
                  <div class="custom-file col-xs-12 col-sm-12" style="padding: 0;">
                    <input #myInput type="file" class="custom-file-input" id="customFile" name="filename" accept=".xlsx"
                      onclick="this.value=null;" value="seleccionar" (change)="setDataFile($event)"
                      [(ngModel)]="archivoExcel">
                    <label class="custom-file-label" for="customFile"
                      style="background-color:#e9ecef">{{this.NombreArchivo == '' ? "Adjuntar Archivo" : this.NombreArchivo }}</label>
                  </div>
                </div>
              </div>
              <div [hidden]="hideMasiva" class="col-xl-4 col-lg-6 d-flex py-1 col-lg-1 " style="align-items: self-end">
                <div class="row col-2 col-sm-4 col-md-6 col-lg-8 col-xl-12">
                  <div *ngIf="mostrarBotonBuscarMasiva()" class="col-xs-12 col-sm-12"
                    style="align-items: center; padding:0">
                    <button (click)="DescargarPlantilla()"
                      class="btn btn-outline-info form-control mr-2 buttonSinBorder colorButton"><i
                        class="fas fa-download"></i> Descargar Plantilla </button>
                  </div>
                </div>
              </div>
              <div [hidden]="hideMasiva" *ngIf="mostrarBotonBuscarMasiva()" class="col-lg-1  py-1 positionbutton"
                style="align-self: flex-end;padding-left: 0;">
                <button _ngcontent-qgx-c1="" id="enter" class="btn btn-warning text-white px-4 btnBuscarStyle"
                  (click)="BusquedaADemandaMixta()">
                  <!-- "validarNulos()" -->
                  Buscar
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="" style="overflow-y:none;">
          <!-- overflow-y:none; -->
          <hr>
          <table class="striped" style="font-size: 12px;">
            <thead>
              <tr>
                <th class="columnGroup1" colspan="5">Datos de la Búsqueda</th>
                <th class="columnGroup2" colspan="2">Persona que se busca</th>
                <th class="columnGroup3" colspan="5">Coincidencia Encontrada</th>
                <th class="columnGroup4" colspan="5"></th>
              </tr>
              <tr style="color: rgba(38, 41, 109, 0.6);font-family: 'Roboto', sans-serif; ">
                <th class="columnGroup1" style="vertical-align: middle;">Fecha y Hora de Búsqueda</th>
                <th class="columnGroup1" style="vertical-align: middle;">Usuario que Realizó la Búsqueda</th>
                <th class="columnGroup1" style="vertical-align: middle;text-align: left;">Lista</th>
                <th class="columnGroup1" style="vertical-align: middle;text-align: left;">Fuente</th>
                <th class="columnGroup1" style="vertical-align: middle;">Búsqueda</th>
                <th class="columnGroup2" style="vertical-align: middle;">Tipo y Número de Documento</th>
                <th class="columnGroup2" style="vertical-align: middle;"> Nombre/Razón Social</th>
                <th class="columnGroup3" style="vertical-align: middle;">Tipo y Número de Documento</th>
                <th class="columnGroup3" style="vertical-align: middle;">Término</th>
                <th class="columnGroup3" style="vertical-align: middle;text-align: left;">Nombre/Razón Social</th>
                <th class="columnGroup3" style="vertical-align: middle;">% Coincidencia</th>
                <th class="columnGroup3" style="vertical-align: middle;">Tipo de Coincidencia</th>
                <th class="columnGroup4" style="vertical-align: middle;">Descargar</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngIf="this.resultadoFinalAgregado.length == 0">
                <td class="text-center" colspan="13">No se encontró coincidencias</td>
              </tr>
              <tr class="animated fadeIn" *ngFor="let item of resultadoFinalAgregado; let i = index;">
                <td>{{item.dfechA_BUSQUEDA}}</td>
                <td>{{item.susuariO_BUSQUEDA != '' ? item.susuariO_BUSQUEDA : '-'}} </td>
                <td>{{item.sdestipolista == null || item.sdestipolista == '' ? '-': item.sdestipolista}}</td>
                <td>{{item.sdesproveedor == null || item.sdesproveedor == '' ? '-': item.sdesproveedor}}</td>
                <td>{{item.scoincidencia == null || item.scoincidencia == '' ? '-': item.scoincidencia}}</td>
                <td>{{item.snumdoC_BUSQUEDA == null || item.snumdoC_BUSQUEDA == '' ? '-': item.snumdoC_BUSQUEDA}}
                </td>
                <td>{{item.snombrE_BUSQUEDA == null || item.snombrE_BUSQUEDA == '' ? '-': item.snombrE_BUSQUEDA}}</td>
                <td>{{(item.stipO_DOCUMENTO == null && item.snuM_DOCUMENTO == null || item.stipO_DOCUMENTO == '-' && item.snuM_DOCUMENTO == '-')  ? "-" : ( item.stipO_DOCUMENTO + " " + item.snuM_DOCUMENTO) }}</td>
                <td>
                  <div placement='top' ngbTooltip="{{item.snombrE_TERMINO}}">
                    {{cortarCararterNombre(item.snombrE_TERMINO == null || item.snombrE_TERMINO == '' ? '-': item.snombrE_TERMINO)}}</div>
                </td>
                <td>
                  <div placement='top' ngbTooltip="{{item.snombrE_COMPLETO}}">
                    {{cortarCararterNombre(item.snombrE_COMPLETO == null || item.snombrE_COMPLETO == '' ? '-': item.snombrE_COMPLETO)}}</div>
                </td>
                <td style="text-align: center;">{{item.sporceN_COINCIDENCIA == null || item.sporceN_COINCIDENCIA == '' ? '-': item.sporceN_COINCIDENCIA}}</td>
                <td>{{item.stipocoincidencia == null || item.stipocoincidencia == '' ? '-': item.stipocoincidencia}}</td>
                <td class=" text-center">
                  <img (click)="CrearPdf(item)" src="assets/icons/pdf2.png" title="Descargar Pdf" alt=""
                    style="cursor: pointer;height:20px;width: 17px;" />
                </td>
              </tr>
            </tbody>
          </table>
          <div *ngIf="this.resultadoFinalAgregado.length > 0" class="row mt-4">
            <div class="col-sm-4">
              <button (click)="exportListToExcel()"
                class="btn btn-outline-info form-control  buttonSinBorder colorButton"><i class="fas fa-download"></i>
                Descargar Resultados
              </button>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</main>
<br>
<app-footer></app-footer>
